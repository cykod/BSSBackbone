<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Data Set</title>
      <script src='js/jquery.min.js'></script>
      <script src='js/handlebars.js'></script>
      <script src='js/underscore.js'></script>
      <script src='js/backbone.js'></script>
</head>
<body>
<script>
$(function() {

  var albumTemplate = window.albumTemplate = Handlebars.compile($("#album-template").html());

  var Album = window.Album = Backbone.Model.extend({});

  var AlbumCollection = window.AlbumCollection = Backbone.Collection.extend({
    model: Album
  });


  var AlbumCollectionView = Backbone.View.extend({
    tagName: "ul",

    initialize: function() {
      this.collection.on("add remove",this.render,this);
    },
    render: function() {
      $(this.el).empty();
      this.collection.each(function(album) {
        $(this.el).append(new AlbumView({model: album }).render().el);
      },this);
      return this;
    }
  });

  var AlbumView = Backbone.View.extend({
    tagName: "li",
    className: "album",
    template: albumTemplate,

    initialize: function(options) {
      _.bindAll(this,"render");
      this.model.on("change",this.render);
    },

    render: function() {
      $(this.el).empty()
                .append(this.template(this.model.toJSON()));
      return this;
    }
  });

  var albums = null;

  var search = encodeURIComponent("California");
  // API Docs
  // http://www.discogs.com/developers/resources/database/search-endpoint.html
  $.getJSON('discogs-data.json',function(response) {

     albums = window.albums = new AlbumCollection(response.results.slice(0,20));

     $("#container").append(new AlbumCollectionView({ collection: albums }).render().el);
  });
});

</script>

<script type='handlebars' id='album-template'>
<img src='{{thumb}}' width='64'/>
<a href='http://www.discogs.com/{{uri}}'>{{title}}</a>
{{#if year}} / Released {{year}} {{/if}}
</script>

<div id='container'>

</div>

</script>
</body>
</html>
